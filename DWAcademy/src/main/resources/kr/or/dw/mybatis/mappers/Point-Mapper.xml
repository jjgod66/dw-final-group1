<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dw.dao.PointDAO">

<insert id="insertMoviePoint">
	INSERT INTO point (point_cd, mem_cd, merchant_uid, point, regdate) VALUES ('A' || lpad(point_seq.nextval,4,0), #{MEM_CD}, #{MERCHANT_UID}, #{PAID_AMOUNT}/20, sysdate)
</insert>

<insert id="insertMoviePointVIP">
	INSERT INTO point (point_cd, mem_cd, merchant_uid, point, regdate) VALUES ('A' || lpad(point_seq.nextval,4,0), #{MEM_CD}, #{MERCHANT_UID}, #{PAID_AMOUNT}/10, sysdate)
</insert>

<select id="selectpointInList" resultType="Map">
	SELECT r.merchant_uid, max(paid_amount) paid_amount, max(r.mem_cd) mem_cd, max(mem_grade) mem_grade
	FROM (
		SELECT *
		FROM screen
		WHERE to_char(startdate, 'yyyyMMdd') = to_char(sysdate - 1, 'yyyyMMdd')
		) s, reservation r, pay_detail p, MEMBER m
	WHERE s.screen_cd = r.screen_cd
	AND r.merchant_uid = p.merchant_uid
	AND r.mem_cd = m.mem_cd
	GROUP BY r.merchant_uid
</select>

</mapper>