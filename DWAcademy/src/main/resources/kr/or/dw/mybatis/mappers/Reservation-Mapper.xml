<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dw.dao.ReservationDAO">
	
	<select id="selectMovieTheater" resultType="Map">
		SELECT t.thr_name, t.thr_loc
		FROM (
				SELECT thr_name
				FROM (
						SELECT house_no
						FROM screen
						WHERE movie_cd = #{movie_cd}
						AND TO_char(startdate, 'YYYY-MM-DD') = #{date}
						GROUP BY house_no
					) s, house h
				WHERE h.house_no = s.house_no
				GROUP BY thr_name
			) h1, theater t
		WHERE h1.thr_name = t.thr_name
	</select>
	
	<select id="selectAllTheater" resultType="Map">
		SELECT thr_loc, thr_name
		FROM theater
	</select>
	
	<select id="selectScreenSchedual" resultType="Map">
		SELECT a.*, h.*
		FROM (
			SELECT screen_cd, house_no, m.movie_cd, startdate, gb_jojo, s.movie_type_cd, movie_type_des, movie_length
			FROM screen s, movie_type mt, movie m
			WHERE s.movie_type_cd = mt.movie_type_cd
			AND s.movie_cd = m.movie_cd
			AND s.movie_cd = #{movie_cd}
			AND TO_char(startdate, 'YYYY-MM-DD') = #{date}
			) a, house h
		WHERE a.house_no = h.house_no
		AND thr_name = #{thr_name}
		ORDER BY startdate
	</select>
	
	<select id="buySeatCount" resultType="int">
		SELECT count(*) buySeat
		FROM reservation r
		WHERE screen_cd = #{screen_cd}
	</select>
	
	<select id="selectScreen" resultType="Map">
		SELECT m.*, h.*, mt.*, s.screen_cd, startdate, gb_jojo
		FROM screen s, movie m, house h, movie_type mt
		WHERE s.movie_cd = m.movie_cd
		AND s.house_no = h.house_no
		AND s.movie_type_cd = mt.movie_type_cd
		AND screen_cd = #{screen_cd}
	</select>
	
	<select id="selectBuySeatList" resultType="str">
		SELECT res_seat
		FROM reservation
		WHERE screen_cd = #{screen_cd}
	</select>
	
	<select id="selectAllMovieRes" resultType="movie">
		SELECT *
		FROM movie
		WHERE enddate > sysdate
	</select>
	
	<select id="selectPaymentScreenInfo" resultType="Map">
		SELECT s.screen_cd, house_name, startdate, movie_type_des, movie_name, movie_length, thr_name, house_name, movie_mainpic_path
		FROM screen s, movie m, house h, movie_type mt
		WHERE s.movie_cd = m.movie_cd
		AND s.house_no = h.house_no
		AND s.movie_type_cd = mt.movie_type_cd
		AND s.screen_cd = #{screen_cd}
	</select>
</mapper>