<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dw.dao.ReservationDAO">
	
	<select id="selectMovieTheater" resultType="Map">
		SELECT t.thr_name, t.thr_loc
		FROM (
				SELECT thr_name
				FROM (
						SELECT house_no
						FROM screen
						WHERE movie_cd = #{movie_cd}
						AND TO_char(startdate, 'YYYY-MM-DD') = #{date}
						GROUP BY house_no
					) s, house h
				WHERE h.house_no = s.house_no
				GROUP BY thr_name
			) h1, theater t
		WHERE h1.thr_name = t.thr_name
	</select>
	
	<select id="selectAllTheater" resultType="Map">
		SELECT thr_loc, thr_name
		FROM theater
	</select>
	
	<select id="selectScreenSchedual" resultType="Map">
		SELECT *
		FROM (
			SELECT *
			FROM screen
			WHERE movie_cd = #{movie_cd}
			AND TO_char(startdate, 'YYYY-MM-DD') = #{date}
			) a, house h
		WHERE a.house_no = h.house_no
		AND thr_name = #{thr_name}
	</select>
	
	<select id="buySeatCount" resultType="int">
		SELECT count(*) buySeat
		FROM reservation r
		WHERE screen_cd = #{screen_cd}
	</select>
</mapper>